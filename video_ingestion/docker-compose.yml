version: '3.8'

services:
  redis:
    image: redis:alpine
    container_name: message_queue
    ports:
      - "6379:6379"

  ingestion:
    build: .
    container_name: video_ingestion
    volumes:
      - /dev/shm:/dev/shm
      # จุดสำคัญ: Mount ไฟล์วิดีโอแบบเดียวกับที่เทสผ่านเมื่อกี้
      - ./test_video.mp4:/app/video.mp4
    depends_on:
      - redis
    # ตั้งค่า Environment ตรงนี้เลย (จะได้ไม่ต้องพะวงกับไฟล์ .env)
    environment:
      - RTSP_URL=/app/video.mp4
      - PLAY_LOOP=true
      - REDIS_HOST=redis
      - QUEUE_NAME=video_frames_queue